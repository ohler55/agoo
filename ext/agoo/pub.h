// Copyright (c) 2018, Peter Ohler, All rights reserved.

#ifndef __AGOO_PUB_H__
#define __AGOO_PUB_H__

#include <stdint.h>
#include <stdlib.h>

typedef enum {
    PUB_SUB	= 'S',
    PUB_CLOSE	= 'C',
    PUB_UN	= 'U',
    PUB_MSG	= 'M',
} PubKind;

// Generated by extened handlers and placed on the pub_queue to be pulled off
// in the con_loop.
typedef struct _Pub {
    struct _Pub		*next;
    PubKind		kind;
    union {
	uint64_t	cid;
	size_t		mlen;
    };
    char		*subject;
    union {
	uint64_t	sid;
	uint8_t		msg[8];
    };
} *Pub;

extern Pub	pub_close(uint64_t cid);
extern Pub	pub_subscribe(uint64_t cid, uint64_t sid, const char *subject);
extern Pub	pub_unsubscribe(uint64_t cid, uint64_t sid);
extern Pub	pub_publish(char *subject, uint8_t *message, size_t mlen);

#endif // __AGOO_PUB_H__
